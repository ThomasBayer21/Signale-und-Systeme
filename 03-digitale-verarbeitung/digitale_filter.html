<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Digitale Filter - FIR vs IIR</title>
<link rel="stylesheet" href="../styles/common.css">
<style>
body{background:linear-gradient(135deg,#d8e8f8 0%,#c8dce8 100%);margin:0;padding:20px;}
h1{font-size:2.2em;font-weight:600;text-align:center;margin:0 0 10px 0;color:#3498db;}
.desc{text-align:center;color:#666;margin-bottom:20px;font-size:0.95em;}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;max-width:1600px;margin:0 auto;}
.sec{background:white;border-radius:8px;padding:18px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.sec.fir{border-top:3px solid #3498db;}
.sec.iir{border-top:3px solid #e67e22;}
.sec h2{font-size:1.4em;margin:0 0 10px 0;text-align:center;}
.sec.fir h2{color:#3498db;}
.sec.iir h2{color:#e67e22;}
.pros{background:#f0f8f4;padding:10px;border-radius:4px;margin:8px 0;font-size:0.85em;color:#555;line-height:1.6;border-left:3px solid #27ae60;}
.pros strong{color:#27ae60;}
.cons{background:#fffef5;padding:10px;border-radius:4px;margin:8px 0;font-size:0.85em;color:#555;line-height:1.6;border-left:3px solid #f39c12;}
.cons strong{color:#f39c12;}
.warn{background:#fff8f8;border-left:3px solid #e74c3c;padding:8px;border-radius:4px;margin:8px 0;font-size:0.85em;color:#555;}
.ctrl{background:#f8f9fa;border-radius:6px;padding:12px;margin:10px 0;}
.ctrl-row{display:grid;grid-template-columns:100px 1fr 50px;gap:10px;align-items:center;margin:8px 0;}
.ctrl-row label{color:#555;font-weight:500;font-size:0.9em;}
.ctrl-row input[type="range"]{width:100%;}
.ctrl-row select{width:100%;padding:6px;font-size:0.9em;border:1px solid #ddd;border-radius:3px;background:white;}
input[type="range"]{height:6px;border-radius:3px;background:#ddd;outline:none;-webkit-appearance:none;appearance:none;}
input[type="range"]::-webkit-slider-track{height:6px;background:#ddd;border-radius:3px;}
input[type="range"]::-moz-range-track{height:6px;background:#ddd;border-radius:3px;}
.fir input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:#3498db;cursor:pointer;}
.fir input[type="range"]::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:#3498db;cursor:pointer;border:none;}
.iir input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:#e67e22;cursor:pointer;}
.iir input[type="range"]::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:#e67e22;cursor:pointer;border:none;}
.val{color:#3498db;font-weight:600;font-size:0.95em;text-align:right;}
.iir .val{color:#e67e22;}
canvas{border:1px solid #ddd;border-radius:4px;background:white;display:block;width:100%;margin:8px 0;height:auto;}
.can-lbl{font-size:0.85em;color:#666;font-weight:600;margin:10px 0 5px 0;text-align:center;}
.stab{padding:8px;margin:8px 0;border-radius:4px;font-weight:600;text-align:center;font-size:0.9em;}
.stab.ok{background:#f0f8f4;color:#27ae60;border:1px solid #27ae60;}
.stab.bad{background:#fff8f8;border:2px solid #e74c3c;color:#e74c3c;}
.comp{background:white;padding:20px;border-radius:8px;margin:0 auto 20px auto;max-width:1600px;box-shadow:0 2px 8px rgba(0,0,0,0.1);border-top:3px solid #2c3e50;}
.comp h2{font-size:1.6em;color:#2c3e50;margin:0 0 12px 0;text-align:center;}
.tbl{width:100%;border-collapse:collapse;margin:12px 0;font-size:0.88em;}
.tbl th{background:#2c3e50;color:white;padding:8px;text-align:center;font-weight:600;font-size:0.9em;}
.tbl th:first-child{background:#34495e;text-align:left;}
.tbl th.fir{background:#5dade2;}
.tbl th.iir{background:#e59866;}
.tbl td{padding:8px;border-bottom:1px solid #ddd;font-size:0.88em;}
.tbl td:first-child{font-weight:600;color:#333;}
.tbl .fir{background:#f4f9fc;}
.tbl .iir{background:#fef9f5;}
.links{background:#f8f9fa;padding:15px;border-radius:6px;margin:20px auto;max-width:1600px;}
.links h4{margin:0 0 10px 0;color:#333;font-size:1em;}
.links a{display:inline-block;color:#3498db;text-decoration:none;padding:5px 10px;margin:2px;background:white;border-radius:3px;font-size:0.9em;}
@media (max-width:1400px){.grid{grid-template-columns:1fr;}}
</style>
</head>
<body>
<h1>Digitale Filter - FIR vs IIR</h1>
<div class="desc">Direkter Vergleich: Sieh die Unterschiede in Impulsantwort, Frequenzgang und Signalfilterung</div>

<div class="comp">
<h2>Schnellvergleich</h2>
<table class="tbl">
<tr><th>Eigenschaft</th><th class="fir">FIR (Finite Impulse Response)</th><th class="iir">IIR (Infinite Impulse Response)</th></tr>
<tr><td><strong>Struktur</strong></td><td class="fir">Nicht-rekursiv (keine Rückkopplung)</td><td class="iir">Rekursiv (mit Rückkopplung)</td></tr>
<tr><td><strong>Gleichung</strong></td><td class="fir">y[n] = Σ h[k]·x[n-k]</td><td class="iir">y[n] = Σ b[k]·x[n-k] - Σ a[k]·y[n-k]</td></tr>
<tr><td><strong>Impulsantwort</strong></td><td class="fir">Endlich (nach N Samples = 0)</td><td class="iir">Theoretisch unendlich (klingt exponentiell ab)</td></tr>
<tr><td><strong>Stabilität</strong></td><td class="fir">✓ Immer stabil</td><td class="iir">⚠ Kann instabil werden</td></tr>
<tr><td><strong>Phase</strong></td><td class="fir">✓ Lineare Phase möglich</td><td class="iir">✗ Nichtlineare Phase</td></tr>
<tr><td><strong>Effizienz</strong></td><td class="fir">Mehr Koeffizienten nötig</td><td class="iir">✓ Weniger Koeffizienten für steile Filter</td></tr>
<tr><td><strong>Best für</strong></td><td class="fir">Audio, Bildverarbeitung, phasentreue Übertragung</td><td class="iir">Echtzeitsysteme, Simulation analoger Filter</td></tr>
</table>
</div>

<div class="grid">
<div class="sec fir">
<h2>FIR-Filter</h2>
<div class="pros"><strong>✓ Vorteile:</strong> Immer stabil • Lineare Phase möglich • Einfache Implementierung • Keine Rückkopplungsprobleme</div>
<div class="cons"><strong>⚠ Nachteile:</strong> Höhere Ordnung für steile Filter • Mehr Rechenaufwand • Größerer Speicherbedarf</div>
<div class="ctrl">
<div class="ctrl-row">
<label>Typ:</label>
<select id="ft"><option value="lowpass">Tiefpass</option><option value="highpass">Hochpass</option><option value="bandpass">Bandpass</option></select>
<span></span>
</div>
<div class="ctrl-row">
<label>Ordnung:</label>
<input type="range" id="fo" min="9" max="81" step="2" value="31">
<span class="val" id="fov">31</span>
</div>
<div class="ctrl-row">
<label>Grenzfreq:</label>
<input type="range" id="fc" min="0.05" max="0.95" step="0.01" value="0.25">
<span class="val" id="fcv">0.25</span>
</div>
<div class="ctrl-row">
<label>Fenster:</label>
<select id="fw"><option value="hamming" selected>Hamming</option><option value="hanning">Hanning</option><option value="blackman">Blackman</option></select>
<span></span>
</div>
</div>
<div class="can-lbl">Impulsantwort h[n]</div>
<canvas id="fi" width="700" height="160"></canvas>
<div class="can-lbl">Frequenzgang |H(f)| (dB)</div>
<canvas id="ff" width="700" height="160"></canvas>
<div class="can-lbl">Signalfilterung (gemischtes Signal: 5Hz + 30Hz + 60Hz)</div>
<canvas id="fs" width="700" height="180"></canvas>
</div>

<div class="sec iir">
<h2>IIR-Filter</h2>
<div class="pros"><strong>✓ Vorteile:</strong> Sehr effizient • Niedrige Ordnung für steile Filter • Wenig Speicher • Ähnlich zu analogen Filtern</div>
<div class="cons"><strong>⚠ Nachteile:</strong> Kann instabil werden • Nichtlineare Phase • Phasenverzerrung • Schwieriger zu entwerfen</div>
<div class="warn"><strong>Stabilitätswarnung:</strong> Pole müssen innerhalb des Einheitskreises liegen!</div>
<div class="ctrl">
<div class="ctrl-row">
<label>Typ:</label>
<select id="it"><option value="butterworth">Butterworth</option><option value="chebyshev">Chebyshev</option><option value="simple">Einfach 1.Ord</option></select>
<span></span>
</div>
<div class="ctrl-row" id="icr">
<label>Grenzfreq:</label>
<input type="range" id="ic" min="0.05" max="0.95" step="0.01" value="0.25">
<span class="val" id="icv">0.25</span>
</div>
<div class="ctrl-row" id="ifr" style="display:none">
<label>Feedback:</label>
<input type="range" id="ifb" min="0" max="1.5" step="0.01" value="0.7">
<span class="val" id="ifbv">0.70</span>
</div>
</div>
<div style="font-size:0.8em;color:#666;text-align:center;margin:-5px 0 8px 0;display:none" id="ifh">Hinweis: Feedback ≥ 1.0 → Instabilität!</div>
<div class="stab ok" id="stab">✓ Filter ist stabil</div>
<div class="can-lbl">Impulsantwort h[n]</div>
<canvas id="ii" width="700" height="160"></canvas>
<div class="can-lbl">Frequenzgang |H(f)| (dB)</div>
<canvas id="if" width="700" height="160"></canvas>
<div class="can-lbl">Signalfilterung (gleiches Signal → Vergleiche Phasenverschiebung!)</div>
<canvas id="is" width="700" height="180"></canvas>
</div>
</div>

<div class="links">
<h4>Verwandte Themen:</h4>
<a href="fensterfunktionen.html">Fensterfunktionen</a>
<a href="z_transformation.html">Z-Transformation</a>
<a href="energie-leistung.html">Energie & Leistung</a>
<a href="index.html">← Zurück</a>
</div>

<script>
const els=id=>document.getElementById(id);
const draw=(ctx,w,h,fn,col='#3498db')=>{const m={l:45,r:20,t:20,b:30},pw=w-m.l-m.r,ph=h-m.t-m.b;ctx.clearRect(0,0,w,h);ctx.fillStyle='#fff';ctx.fillRect(0,0,w,h);ctx.strokeStyle='#e8e8e8';ctx.lineWidth=1;for(let i=0;i<=4;i++){const y=m.t+(i/4)*ph;ctx.beginPath();ctx.moveTo(m.l,y);ctx.lineTo(w-m.r,y);ctx.stroke();}ctx.strokeStyle='#333';ctx.lineWidth=1.5;ctx.beginPath();ctx.moveTo(m.l,m.t);ctx.lineTo(m.l,h-m.b);ctx.lineTo(w-m.r,h-m.b);ctx.stroke();ctx.strokeStyle=col;ctx.lineWidth=2;ctx.beginPath();fn(ctx,m,pw,ph);ctx.stroke();};

// FIR
let fs={t:'lowpass',o:31,c:0.25,w:'hamming'};
const sinc=x=>Math.abs(x)<1e-10?1:Math.sin(Math.PI*x)/(Math.PI*x);
const win=(n,N)=>{switch(fs.w){case 'hamming':return 0.54-0.46*Math.cos(2*Math.PI*n/(N-1));case 'hanning':return 0.5-0.5*Math.cos(2*Math.PI*n/(N-1));case 'blackman':return 0.42-0.5*Math.cos(2*Math.PI*n/(N-1))+0.08*Math.cos(4*Math.PI*n/(N-1));default:return 1;}};
const designFIR=()=>{const N=fs.o,h=new Array(N),M=(N-1)/2;for(let n=0;n<N;n++){const ns=n-M;let v=0;switch(fs.t){case 'lowpass':v=fs.c*sinc(fs.c*ns);break;case 'highpass':v=(n===M?1:0)-fs.c*sinc(fs.c*ns);break;case 'bandpass':v=0.7*sinc(0.7*ns)-fs.c*sinc(fs.c*ns);break;}h[n]=v*win(n,N);}return h;};
const firFreq=(h,np=512)=>{const r=[];for(let k=0;k<np;k++){const w=(k/np)*Math.PI;let re=0,im=0;for(let n=0;n<h.length;n++){re+=h[n]*Math.cos(w*n);im-=h[n]*Math.sin(w*n);}const mag=Math.sqrt(re*re+im*im);r.push(mag>1e-10?20*Math.log10(mag):-100);}return r;};
const firFilt=(sig,h)=>{const o=[];for(let n=0;n<sig.length;n++){let s=0;for(let k=0;k<h.length;k++)if(n-k>=0)s+=h[k]*sig[n-k];o.push(s);}return o;};
const drawFIR=()=>{const h=designFIR(),r=firFreq(h);const ci=els('fi'),cf=els('ff'),cs=els('fs');draw(ci.getContext('2d'),ci.width,ci.height,(ctx,m,pw,ph)=>{const cy=m.t+ph/2,mx=Math.max(...h.map(Math.abs)),sc=(ph/2)*0.8/mx;for(let n=0;n<h.length;n++){const x=m.l+(n/(h.length-1))*pw,y=cy-h[n]*sc;ctx.moveTo(x,cy);ctx.lineTo(x,y);ctx.moveTo(x,y);ctx.arc(x,y,2.5,0,2*Math.PI);}});draw(cf.getContext('2d'),cf.width,cf.height,(ctx,m,pw,ph)=>{const sc=ph/100;ctx.moveTo(m.l,cf.height-m.b+100*sc);for(let i=0;i<r.length;i++){const x=m.l+(i/(r.length-1))*pw,y=cf.height-m.b+r[i]*sc;ctx.lineTo(x,y);}ctx.strokeStyle='#2980b9';ctx.lineWidth=2;ctx.stroke();ctx.setLineDash([3,3]);ctx.strokeStyle='#3498db';ctx.lineWidth=1.5;ctx.beginPath();const cx=m.l+fs.c*pw;ctx.moveTo(cx,m.t);ctx.lineTo(cx,cf.height-m.b);ctx.stroke();ctx.setLineDash([]);},'#3498db');const sig=[],ns=300;for(let n=0;n<ns;n++){const t=n/ns;sig.push(0.5*Math.sin(2*Math.PI*5*t)+0.3*Math.sin(2*Math.PI*30*t)+0.2*Math.sin(2*Math.PI*60*t));}const flt=firFilt(sig,h);draw(cs.getContext('2d'),cs.width,cs.height,(ctx,m,pw,ph)=>{const cy=m.t+ph/2,sc=(ph/2)*0.75;ctx.strokeStyle='#95a5a6';ctx.lineWidth=1.5;ctx.beginPath();for(let n=0;n<sig.length;n++){const x=m.l+(n/(sig.length-1))*pw,y=cy-sig[n]*sc;n===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}ctx.stroke();ctx.strokeStyle='#2980b9';ctx.lineWidth=2.5;ctx.beginPath();for(let n=0;n<flt.length;n++){const x=m.l+(n/(flt.length-1))*pw,y=cy-flt[n]*sc;n===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}ctx.stroke();ctx.fillStyle='#95a5a6';ctx.font='11px Arial';ctx.textAlign='left';ctx.fillText('Original (grau)',m.l+5,m.t+15);ctx.fillStyle='#2980b9';ctx.fillText('FIR gefiltert (blau)',m.l+5,m.t+30);},'#3498db');};
els('ft').onchange=e=>{fs.t=e.target.value;drawFIR();};
els('fo').oninput=e=>{fs.o=+e.target.value+(+e.target.value%2===0?1:0);els('fov').textContent=fs.o;drawFIR();};
els('fc').oninput=e=>{fs.c=+e.target.value;els('fcv').textContent=fs.c.toFixed(2);drawFIR();};
els('fw').onchange=e=>{fs.w=e.target.value;drawFIR();};

// IIR
let is={t:'butterworth',c:0.25,fb:0.7};
const designIIR=()=>{let b,a,poles=[];if(is.t==='simple'){const al=1-is.fb;b=[al];a=[1,-is.fb];poles=[{r:is.fb,i:0}];}else if(is.t==='butterworth'){const wc=Math.tan(Math.PI*is.c/2),k=wc*wc,q=1/Math.sqrt(2),n=k+wc/q+1;b=[k/n,2*k/n,k/n];a=[1,2*(k-1)/n,(k-wc/q+1)/n];const ang=Math.PI*(0.25+0.5*is.c),r=Math.sqrt(Math.abs(a[2]));poles=[{r:r*Math.cos(ang),i:r*Math.sin(ang)},{r:r*Math.cos(ang),i:-r*Math.sin(ang)}];}else{const wc=Math.tan(Math.PI*is.c/2),e=Math.sqrt(Math.pow(10,0.5/10)-1),k=wc*wc,n=k+wc*e+1;b=[k/n,2*k/n,k/n];a=[1,2*(k-1)/n,(k-wc*e+1)/n];const ang=Math.PI*(0.2+0.6*is.c),r=Math.sqrt(Math.abs(a[2]))*0.9;poles=[{r:r*Math.cos(ang),i:r*Math.sin(ang)},{r:r*Math.cos(ang),i:-r*Math.sin(ang)}];}return {b,a,poles};};
const iirStab=poles=>{for(let p of poles){const m=Math.sqrt(p.r*p.r+p.i*p.i);if(m>=1)return false;}return true;};
const iirImp=(b,a,ns=100)=>{const h=Array(ns).fill(0);h[0]=b[0];for(let n=1;n<ns;n++){let s=0;for(let k=0;k<b.length&&k<=n;k++)s+=b[k]*(k===0||k===n?1:0);for(let k=1;k<a.length&&k<=n;k++)s-=a[k]*h[n-k];h[n]=s;}return h;};
const iirFreq=(b,a,np=512)=>{const r=[];for(let k=0;k<np;k++){const w=(k/np)*Math.PI;let nr=0,ni=0,dr=0,di=0;for(let n=0;n<b.length;n++){nr+=b[n]*Math.cos(w*n);ni-=b[n]*Math.sin(w*n);}for(let n=0;n<a.length;n++){dr+=a[n]*Math.cos(w*n);di-=a[n]*Math.sin(w*n);}const dm=dr*dr+di*di,re=(nr*dr+ni*di)/dm,im=(ni*dr-nr*di)/dm;const mag=Math.sqrt(re*re+im*im);r.push(mag>1e-10?20*Math.log10(mag):-100);}return r;};
const iirFilt=(sig,b,a)=>{const o=Array(sig.length).fill(0);for(let n=0;n<sig.length;n++){let s=0;for(let k=0;k<b.length;k++)if(n-k>=0)s+=b[k]*sig[n-k];for(let k=1;k<a.length;k++)if(n-k>=0)s-=a[k]*o[n-k];o[n]=s/a[0];}return o;};
const drawIIR=()=>{const {b,a,poles}=designIIR(),stb=iirStab(poles),h=iirImp(b,a),r=iirFreq(b,a);els('stab').className=stb?'stab ok':'stab bad';els('stab').textContent=stb?'✓ Filter ist stabil':'✗ WARNUNG: INSTABIL!';const ci=els('ii'),cf=els('if'),cs=els('is');draw(ci.getContext('2d'),ci.width,ci.height,(ctx,m,pw,ph)=>{const cy=m.t+ph/2,mx=Math.max(...h.map(v=>Math.abs(v)),0.1),sc=(ph/2)*0.8/mx;for(let n=0;n<h.length;n++){const x=m.l+(n/(h.length-1))*pw,y=cy-Math.max(-10,Math.min(10,h[n]))*sc;ctx.moveTo(x,cy);ctx.lineTo(x,y);ctx.moveTo(x,y);ctx.arc(x,y,2.5,0,2*Math.PI);}},'#e67e22');draw(cf.getContext('2d'),cf.width,cf.height,(ctx,m,pw,ph)=>{const sc=ph/100;ctx.moveTo(m.l,cf.height-m.b+100*sc);for(let i=0;i<r.length;i++){const x=m.l+(i/(r.length-1))*pw,y=cf.height-m.b+r[i]*sc;ctx.lineTo(x,y);}ctx.strokeStyle='#d35400';ctx.lineWidth=2;ctx.stroke();},'#e67e22');const sig=[],ns=300;for(let n=0;n<ns;n++){const t=n/ns;sig.push(0.5*Math.sin(2*Math.PI*5*t)+0.3*Math.sin(2*Math.PI*30*t)+0.2*Math.sin(2*Math.PI*60*t));}const flt=iirFilt(sig,b,a);const mx=Math.max(...flt.map(v=>Math.abs(v)));const unstable=mx>100||!isFinite(mx);draw(cs.getContext('2d'),cs.width,cs.height,(ctx,m,pw,ph)=>{const cy=m.t+ph/2,sc=(ph/2)*0.75;ctx.strokeStyle='#95a5a6';ctx.lineWidth=1.5;ctx.beginPath();for(let n=0;n<sig.length;n++){const x=m.l+(n/(sig.length-1))*pw,y=cy-sig[n]*sc;n===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}ctx.stroke();ctx.strokeStyle=unstable?'#e74c3c':'#d35400';ctx.lineWidth=2.5;ctx.beginPath();for(let n=0;n<flt.length;n++){const val=unstable?Math.max(-2,Math.min(2,flt[n]/mx*2)):flt[n];const x=m.l+(n/(flt.length-1))*pw,y=cy-val*sc;n===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}ctx.stroke();ctx.fillStyle='#95a5a6';ctx.font='11px Arial';ctx.textAlign='left';ctx.fillText('Original (grau)',m.l+5,m.t+15);ctx.fillStyle=unstable?'#e74c3c':'#d35400';ctx.fillText(unstable?'IIR gefiltert (INSTABIL!)':'IIR gefiltert (orange)',m.l+5,m.t+30);if(unstable){ctx.fillStyle='#e74c3c';ctx.font='bold 14px Arial';ctx.textAlign='center';ctx.fillText('⚠ Signal schwingt sich auf (Instabilität)!',cs.width/2,m.t+60);}},'#e67e22');};
els('it').onchange=e=>{is.t=e.target.value;const simp=is.t==='simple';els('icr').style.display=simp?'none':'grid';els('ifr').style.display=simp?'grid':'none';els('ifh').style.display=simp?'block':'none';drawIIR();};
els('ic').oninput=e=>{is.c=+e.target.value;els('icv').textContent=is.c.toFixed(2);drawIIR();};
els('ifb').oninput=e=>{is.fb=+e.target.value;els('ifbv').textContent=is.fb.toFixed(2);drawIIR();};

drawFIR();drawIIR();
</script>
</body>
</html>
