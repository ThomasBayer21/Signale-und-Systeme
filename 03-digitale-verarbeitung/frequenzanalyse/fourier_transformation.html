<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fourier-Transformation Visualisierung</title>
    <link rel="stylesheet" href="../../styles/common.css">
    <style>
        body {
            background: linear-gradient(135deg, #d8e8f8 0%, #c8dce8 100%);
        }

        .container {
            max-width: var(--container-width-interactive);
            margin: 0 auto;
        }

        /* Canvas Dimensionen angepasst */

        /* Controls kompakter */

        .frequency-controls {
            display: grid;
            gap: 15px;
        }

        .frequency-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 15px;
            align-items: center;
        }

        .frequency-item.active {
            border-left: 4px solid #3498db;
        }

        .frequency-label {
            font-weight: bold;
            color: #333;
            min-width: 80px;
        }

        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-container label {
            color: #666;
            font-size: 0.9em;
            min-width: 90px;
        }

        /* Slider-Farben verwenden theme color */
        input[type="range"]::-webkit-slider-thumb {
            background: var(--color-digital);
        }

        input[type="range"]::-moz-range-thumb {
            background: var(--color-digital);
        }

        .value-display {
            color: var(--color-digital);
        }

        .toggle-btn.active {
            background: var(--color-digital);
            color: white;
        }

        .toggle-btn.inactive {
            background: #e0e0e0;
            color: #999;
        }

        .preset-btn {
            border-color: var(--color-digital);
            color: var(--color-digital);
        }

        .preset-btn:hover {
            background: var(--color-digital);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fourier-Transformation</h1>
        <p class="subtitle">Interaktive Visualisierung: Wie Frequenzen ein Signal formen</p>

        <div class="preset-buttons">
            <button class="preset-btn" onclick="setPreset('sine')">Einfache Sinuswelle</button>
            <button class="preset-btn" onclick="setPreset('square')">Rechtecksignal</button>
            <button class="preset-btn" onclick="setPreset('sawtooth')">Sägezahn</button>
            <button class="preset-btn" onclick="setPreset('complex')">Komplexes Signal</button>
            <button class="preset-btn" onclick="setPreset('reset')">Zurücksetzen</button>
        </div>

        <div class="canvas-container">
            <div class="canvas-wrapper">
                <h2>Zeitbereich (Signal)</h2>
                <canvas id="timeCanvas" width="600" height="250"></canvas>
            </div>
            <div class="canvas-wrapper">
                <h2>Frequenzbereich (Spektrum)</h2>
                <canvas id="frequencyCanvas" width="600" height="250"></canvas>
            </div>
        </div>

        <div class="controls">
            <h3>Frequenzkomponenten steuern</h3>
            <div class="frequency-controls" id="frequencyControls"></div>
        </div>

        <div class="info-box">
            <p><strong>Was ist die Fourier-Transformation?</strong></p>
            <p>Die Fourier-Transformation zerlegt ein Signal in seine Frequenzkomponenten. Jedes komplexe Signal kann als Summe von einfachen Sinuswellen unterschiedlicher Frequenzen, Amplituden und Phasen dargestellt werden.</p>
            <p><strong>Anleitung:</strong> Aktivieren Sie verschiedene Frequenzen und ändern Sie deren Amplitude und Phase. Beobachten Sie, wie sich das Zeitsignal (links) und das Frequenzspektrum (rechts) verändern.</p>
        </div>
    </div>

    <script>
        const timeCanvas = document.getElementById('timeCanvas');
        const freqCanvas = document.getElementById('frequencyCanvas');
        const timeCtx = timeCanvas.getContext('2d');
        const freqCtx = freqCanvas.getContext('2d');

        // Frequenzen (Hz) - 8 Harmonische
        const frequencies = [1, 2, 3, 4, 5, 6, 7, 8];

        // Status jeder Frequenz
        const frequencyStates = frequencies.map(f => ({
            freq: f,
            active: false,
            amplitude: 1.0,
            phase: 0
        }));

        // Samples für die Darstellung
        const numSamples = 1000;
        const samplingRate = 50; // Hz

        // Farben für verschiedene Frequenzen
        const colors = [
            '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A',
            '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'
        ];

        function createControls() {
            const container = document.getElementById('frequencyControls');
            container.innerHTML = '';

            frequencyStates.forEach((state, index) => {
                const item = document.createElement('div');
                item.className = 'frequency-item';
                item.id = `freq-item-${index}`;

                const label = document.createElement('div');
                label.className = 'frequency-label';
                label.style.color = colors[index];
                label.textContent = `${state.freq} Hz`;

                const sliderGroup = document.createElement('div');
                sliderGroup.className = 'slider-group';

                // Amplitude Slider
                const ampContainer = document.createElement('div');
                ampContainer.className = 'slider-container';

                const ampLabel = document.createElement('label');
                ampLabel.textContent = 'Amplitude:';

                const ampSlider = document.createElement('input');
                ampSlider.type = 'range';
                ampSlider.min = '0';
                ampSlider.max = '100';
                ampSlider.value = state.amplitude * 100;
                ampSlider.id = `amp-${index}`;

                const ampValue = document.createElement('span');
                ampValue.className = 'value-display';
                ampValue.id = `amp-val-${index}`;
                ampValue.textContent = state.amplitude.toFixed(2);

                ampSlider.addEventListener('input', (e) => {
                    state.amplitude = e.target.value / 100;
                    ampValue.textContent = state.amplitude.toFixed(2);
                    draw();
                });

                ampContainer.appendChild(ampLabel);
                ampContainer.appendChild(ampSlider);
                ampContainer.appendChild(ampValue);

                // Phase Slider
                const phaseContainer = document.createElement('div');
                phaseContainer.className = 'slider-container';

                const phaseLabel = document.createElement('label');
                phaseLabel.textContent = 'Phase (°):';

                const phaseSlider = document.createElement('input');
                phaseSlider.type = 'range';
                phaseSlider.min = '0';
                phaseSlider.max = '360';
                phaseSlider.value = (state.phase * 180 / Math.PI);
                phaseSlider.id = `phase-${index}`;

                const phaseValue = document.createElement('span');
                phaseValue.className = 'value-display';
                phaseValue.id = `phase-val-${index}`;
                phaseValue.textContent = Math.round(state.phase * 180 / Math.PI) + '°';

                phaseSlider.addEventListener('input', (e) => {
                    state.phase = e.target.value * Math.PI / 180;
                    phaseValue.textContent = Math.round(e.target.value) + '°';
                    draw();
                });

                phaseContainer.appendChild(phaseLabel);
                phaseContainer.appendChild(phaseSlider);
                phaseContainer.appendChild(phaseValue);

                sliderGroup.appendChild(ampContainer);
                sliderGroup.appendChild(phaseContainer);

                // Toggle Button
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'toggle-btn inactive';
                toggleBtn.textContent = 'AUS';
                toggleBtn.onclick = () => toggleFrequency(index);
                toggleBtn.id = `toggle-${index}`;

                item.appendChild(label);
                item.appendChild(sliderGroup);
                item.appendChild(toggleBtn);

                container.appendChild(item);
            });
        }

        function toggleFrequency(index) {
            frequencyStates[index].active = !frequencyStates[index].active;
            const btn = document.getElementById(`toggle-${index}`);
            const item = document.getElementById(`freq-item-${index}`);

            if (frequencyStates[index].active) {
                btn.className = 'toggle-btn active';
                btn.textContent = 'AN';
                item.classList.add('active');
            } else {
                btn.className = 'toggle-btn inactive';
                btn.textContent = 'AUS';
                item.classList.remove('active');
            }

            draw();
        }

        function computeSignal() {
            const signal = new Array(numSamples).fill(0);
            const dt = 1 / samplingRate;

            for (let i = 0; i < numSamples; i++) {
                const t = i * dt;

                frequencyStates.forEach(state => {
                    if (state.active) {
                        signal[i] += state.amplitude * Math.sin(2 * Math.PI * state.freq * t + state.phase);
                    }
                });
            }

            return signal;
        }

        function drawTimeSignal(signal) {
            const width = timeCanvas.width;
            const height = timeCanvas.height;
            const padding = 40;
            const plotWidth = width - 2 * padding;
            const plotHeight = height - 2 * padding;

            timeCtx.clearRect(0, 0, width, height);

            // Hintergrund
            timeCtx.fillStyle = '#ffffff';
            timeCtx.fillRect(0, 0, width, height);

            // Achsen
            timeCtx.strokeStyle = '#333';
            timeCtx.lineWidth = 2;
            timeCtx.beginPath();
            timeCtx.moveTo(padding, padding);
            timeCtx.lineTo(padding, height - padding);
            timeCtx.lineTo(width - padding, height - padding);
            timeCtx.stroke();

            // Nulllinie
            timeCtx.strokeStyle = '#ccc';
            timeCtx.lineWidth = 1;
            timeCtx.setLineDash([5, 5]);
            timeCtx.beginPath();
            timeCtx.moveTo(padding, height / 2);
            timeCtx.lineTo(width - padding, height / 2);
            timeCtx.stroke();
            timeCtx.setLineDash([]);

            // Signal zeichnen
            if (signal.some(v => v !== 0)) {
                const maxAmp = Math.max(Math.abs(Math.max(...signal)), Math.abs(Math.min(...signal)), 1);

                timeCtx.strokeStyle = '#3498db';
                timeCtx.lineWidth = 2.5;
                timeCtx.beginPath();

                for (let i = 0; i < signal.length; i++) {
                    const x = padding + (i / signal.length) * plotWidth;
                    const y = height / 2 - (signal[i] / maxAmp) * (plotHeight / 2) * 0.9;

                    if (i === 0) {
                        timeCtx.moveTo(x, y);
                    } else {
                        timeCtx.lineTo(x, y);
                    }
                }

                timeCtx.stroke();
            }

            // Beschriftungen
            timeCtx.fillStyle = '#333';
            timeCtx.font = 'bold 14px Arial';
            timeCtx.textAlign = 'center';
            timeCtx.fillText('Zeit (s)', width / 2, height - 10);

            timeCtx.save();
            timeCtx.translate(15, height / 2);
            timeCtx.rotate(-Math.PI / 2);
            timeCtx.fillText('Amplitude', 0, 0);
            timeCtx.restore();

            // Zeitmarkierungen
            timeCtx.font = '12px Arial';
            timeCtx.fillStyle = '#666';
            for (let i = 0; i <= 4; i++) {
                const t = (i / 4) * (numSamples / samplingRate);
                const x = padding + (i / 4) * plotWidth;
                timeCtx.fillText(t.toFixed(1), x, height - padding + 20);
            }
        }

        function drawFrequencySpectrum() {
            const width = freqCanvas.width;
            const height = freqCanvas.height;
            const padding = 40;
            const plotWidth = width - 2 * padding;
            const plotHeight = height - 2 * padding;

            freqCtx.clearRect(0, 0, width, height);

            // Hintergrund
            freqCtx.fillStyle = '#ffffff';
            freqCtx.fillRect(0, 0, width, height);

            // Achsen
            freqCtx.strokeStyle = '#333';
            freqCtx.lineWidth = 2;
            freqCtx.beginPath();
            freqCtx.moveTo(padding, padding);
            freqCtx.lineTo(padding, height - padding);
            freqCtx.lineTo(width - padding, height - padding);
            freqCtx.stroke();

            // Balken für jede Frequenz
            const maxFreq = Math.max(...frequencies);
            const maxAmp = Math.max(...frequencyStates.map(s => s.active ? s.amplitude : 0), 0.1);
            const barWidth = plotWidth / (frequencies.length * 2);

            frequencyStates.forEach((state, index) => {
                if (state.active && state.amplitude > 0) {
                    const x = padding + (index + 0.5) * (plotWidth / frequencies.length);
                    const barHeight = (state.amplitude / maxAmp) * plotHeight * 0.9;
                    const y = height - padding - barHeight;

                    freqCtx.fillStyle = colors[index];
                    freqCtx.fillRect(x - barWidth / 2, y, barWidth, barHeight);

                    // Amplitudenwert
                    freqCtx.fillStyle = '#333';
                    freqCtx.font = 'bold 11px Arial';
                    freqCtx.textAlign = 'center';
                    freqCtx.fillText(state.amplitude.toFixed(2), x, y - 5);
                }
            });

            // Beschriftungen
            freqCtx.fillStyle = '#333';
            freqCtx.font = 'bold 14px Arial';
            freqCtx.textAlign = 'center';
            freqCtx.fillText('Frequenz (Hz)', width / 2, height - 10);

            freqCtx.save();
            freqCtx.translate(15, height / 2);
            freqCtx.rotate(-Math.PI / 2);
            freqCtx.fillText('Amplitude', 0, 0);
            freqCtx.restore();

            // Frequenzmarkierungen
            freqCtx.font = '12px Arial';
            freqCtx.fillStyle = '#666';
            frequencyStates.forEach((state, index) => {
                const x = padding + (index + 0.5) * (plotWidth / frequencies.length);
                freqCtx.fillText(state.freq + ' Hz', x, height - padding + 20);
            });
        }

        function draw() {
            const signal = computeSignal();
            drawTimeSignal(signal);
            drawFrequencySpectrum();
        }

        function setPreset(preset) {
            // Alle zurücksetzen
            frequencyStates.forEach((state, i) => {
                state.active = false;
                state.amplitude = 1.0;
                state.phase = 0;
            });

            switch(preset) {
                case 'sine':
                    frequencyStates[0].active = true;
                    break;

                case 'square':
                    // Rechteck = ungerade Harmonische mit abnehmender Amplitude
                    [0, 2, 4, 6].forEach((i, idx) => {
                        if (i < frequencyStates.length) {
                            frequencyStates[i].active = true;
                            frequencyStates[i].amplitude = 1.0 / (i + 1);
                        }
                    });
                    break;

                case 'sawtooth':
                    // Sägezahn = alle Harmonische mit 1/n Amplitude
                    frequencyStates.forEach((state, i) => {
                        state.active = true;
                        state.amplitude = 1.0 / (i + 1);
                    });
                    break;

                case 'complex':
                    frequencyStates[0].active = true;
                    frequencyStates[0].amplitude = 1.0;
                    frequencyStates[2].active = true;
                    frequencyStates[2].amplitude = 0.5;
                    frequencyStates[4].active = true;
                    frequencyStates[4].amplitude = 0.3;
                    frequencyStates[6].active = true;
                    frequencyStates[6].amplitude = 0.2;
                    break;

                case 'reset':
                    // Bereits alle zurückgesetzt
                    break;
            }

            // UI aktualisieren
            frequencyStates.forEach((state, i) => {
                const btn = document.getElementById(`toggle-${i}`);
                const item = document.getElementById(`freq-item-${i}`);
                const ampSlider = document.getElementById(`amp-${i}`);
                const ampVal = document.getElementById(`amp-val-${i}`);
                const phaseSlider = document.getElementById(`phase-${i}`);
                const phaseVal = document.getElementById(`phase-val-${i}`);

                if (state.active) {
                    btn.className = 'toggle-btn active';
                    btn.textContent = 'AN';
                    item.classList.add('active');
                } else {
                    btn.className = 'toggle-btn inactive';
                    btn.textContent = 'AUS';
                    item.classList.remove('active');
                }

                ampSlider.value = state.amplitude * 100;
                ampVal.textContent = state.amplitude.toFixed(2);
                phaseSlider.value = state.phase * 180 / Math.PI;
                phaseVal.textContent = Math.round(state.phase * 180 / Math.PI) + '°';
            });

            draw();
        }

        // Initialisierung
        createControls();
        draw();

        // Standardmäßig eine Sinuswelle zeigen
        setTimeout(() => setPreset('sine'), 100);
    </script>
</body>
</html>